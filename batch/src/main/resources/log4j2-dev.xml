<?xml version="1.0" encoding="UTF-8"?>

<Configuration>
    <Properties>
        <Property name="logBaseDir">${bundle:application:application.basedir}/${bundle:application:log4j2.logdir}</Property>
        <Property name="logFileName">${bundle:application:application.name}</Property>
        <Property name="errorFileName">${bundle:application:application.name}_error</Property>
        <Property name="debugFileName">${bundle:application:application.name}_debug</Property>

        <Property name="sizeTriggerPolicy">200 MB</Property>
        <Property name="deleteAgeFile">15d</Property>
        <Property name="keepMostRecentFile">10</Property>
        <Property name="keepMostRecentSize">100 MB</Property>
    </Properties>

    <Appenders>
        <Console name="Console">
            <PatternLayout pattern="%style{%d{ISO8601}}{black} %highlight{%-5level }[%style{%t}{bright,blue}] %style{%C{1.}}{dark,yellow}: %msg%n%throwable" />
        </Console>

        <RollingFile name="LogFile"
                     fileName="${logBaseDir}/${logFileName}.log"
                     filePattern="${logBaseDir}/$${date:yyyy-MM}/${logFileName}_%d{dd-MM-yyyy}_%i.log.gz">
            <PatternLayout>
                <pattern>%5p %d{ISO8601} [%t][%x] %c - %m%n</pattern>
            </PatternLayout>
            <Policies>
                <OnStartupTriggeringPolicy />
                <SizeBasedTriggeringPolicy size="${sizeTriggerPolicy}" />
                <TimeBasedTriggeringPolicy />
            </Policies>
            <DefaultRolloverStrategy>
                <Delete basePath="${logBaseDir}" maxDepth="2">
                    <IfFileName glob="*/${logFileName}_*.log.gz">
                        <IfLastModified age="${deleteAgeFile}" />
                        <IfAny>
                            <IfAccumulatedFileCount exceeds="${keepMostRecentFile}" />
                            <IfAccumulatedFileSize exceeds="${keepMostRecentSize}" />
                        </IfAny>
                    </IfFileName>
                </Delete>
            </DefaultRolloverStrategy>
        </RollingFile>

        <RollingFile name="ErrorFile"
                     fileName="${logBaseDir}/${errorFileName}.log"
                     filePattern="${logBaseDir}/$${date:yyyy-MM}/${errorFileName}_%d{dd-MM-yyyy}_%i.log.gz">
            <LevelRangeFilter minLevel="ERROR" maxLevel="ERROR" onMatch="ACCEPT" onMismatch="DENY"/>
            <PatternLayout>
                <pattern>%5p %d{ISO8601} [%t][%x] %c - %m%n</pattern>
            </PatternLayout>
            <Policies>
                <OnStartupTriggeringPolicy />
                <SizeBasedTriggeringPolicy size="${sizeTriggerPolicy}" />
                <TimeBasedTriggeringPolicy />
            </Policies>
            <DefaultRolloverStrategy>
                <Delete basePath="${logBaseDir}/" maxDepth="2">
                    <IfFileName glob="*/${errorFileName}_*.log.gz">
                        <IfLastModified age="${deleteAgeFile}" />
                        <IfAny>
                            <IfAccumulatedFileCount exceeds="${keepMostRecentFile}" />
                            <IfAccumulatedFileSize exceeds="${keepMostRecentSize}" />
                        </IfAny>
                    </IfFileName>
                </Delete>
            </DefaultRolloverStrategy>
        </RollingFile>

        <RollingFile name="DebugFile"
                     fileName="${logBaseDir}/${debugFileName}.log"
                     filePattern="${logBaseDir}/$${date:yyyy-MM}/${debugFileName}_%d{dd-MM-yyyy}_%i.log.gz">
            <LevelRangeFilter minLevel="DEBUG" maxLevel="TRACE" onMatch="ACCEPT" onMismatch="DENY"/>
            <PatternLayout>
                <pattern>%5p %d{ISO8601} [%t][%x] %c - %m%n</pattern>
            </PatternLayout>
            <Policies>
                <OnStartupTriggeringPolicy />
                <SizeBasedTriggeringPolicy size="${sizeTriggerPolicy}" />
                <TimeBasedTriggeringPolicy />
            </Policies>
            <DefaultRolloverStrategy>
                <Delete basePath="${logBaseDir}/" maxDepth="2">
                    <IfFileName glob="*/${debugFileName}_*.log.gz">
                        <IfLastModified age="${deleteAgeFile}" />
                        <IfAny>
                            <IfAccumulatedFileCount exceeds="${keepMostRecentFile}" />
                            <IfAccumulatedFileSize exceeds="${keepMostRecentSize}" />
                        </IfAny>
                    </IfFileName>
                </Delete>
            </DefaultRolloverStrategy>
        </RollingFile>

    </Appenders>

    <Loggers>
        <Root level="all">
            <AppenderRef ref="Console" />
            <AppenderRef ref="DebugFile" />
            <AppenderRef ref="LogFile" />
            <AppenderRef ref="ErrorFile" />
        </Root>
    </Loggers>
</Configuration>